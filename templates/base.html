<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="{{ csrf_token }}" />
    <title>
      {% block title %}
        Crave - My Recipes
      {% endblock %}
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
        overflow-x: hidden;
      }
      .cloud {
        position: absolute;
        background-color: #5b6777;
        border-radius: 50%;
        opacity: 0.8;
        filter: blur(20px);
        animation: float 12s ease-in-out infinite;
        z-index: -1;
        will-change: transform;
      }
      .cloud:nth-child(1) {
        width: 200px;
        height: 80px;
        top: 20%;
        left: 10%;
        animation-delay: 0s;
      }
      .cloud:nth-child(2) {
        width: 300px;
        height: 100px;
        top: 40%;
        left: 60%;
        animation-delay: 3s;
      }
      .cloud:nth-child(3) {
        width: 250px;
        height: 90px;
        top: 70%;
        left: 30%;
        animation-delay: 6s;
      }
      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-20px);
        }
      }
      .nav-link {
        position: relative;
      }
      .nav-link::after {
        content: '';
        position: absolute;
        width: 0;
        height: 2px;
        bottom: -2px;
        left: 0;
        background-color: #f97316;
        transition: width 0.3s ease;
      }
      .nav-link:hover::after {
        width: 100%;
      }
      .desktop-menu {
        display: flex;
      }
      .mobile-menu {
        display: none;
      }
      #mobile-nav {
        display: none;
        transform: scaleY(0);
        transform-origin: top;
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
      }
      #mobile-nav:not(.hidden) {
        display: flex;
        transform: scaleY(1);
        opacity: 1;
      }
      @media (max-width: 768px) {
        .desktop-menu {
          display: none !important;
        }
        .mobile-menu {
          display: block !important;
        }
        #mobile-nav:not(.hidden) {
          display: flex;
          transform: scaleY(1);
          height: auto;
        }
        #menu-btn {
          background: none;
          border: none;
          cursor: pointer;
          padding: 0.5rem;
        }
      }
    </style>
  </head>

  <body class="bg-white text-gray-800 min-h-screen">
    <div class="cloud" aria-hidden="true"></div>
    <div class="cloud" aria-hidden="true"></div>
    <div class="cloud" aria-hidden="true"></div>

    <nav class="bg-white shadow-md sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-2">
          <div class="h-10 w-10">
            <img src="{{ url_for('static', filename='images/mascot.png') }}" alt="Crave Logo" class="h-full w-full object-contain" />
          </div>
          <span class="text-xl font-bold">Crave</span>
        </div>
        <ul class="desktop-menu flex items-center gap-6 text-sm font-medium">
          <li>
            <a href="{{ url_for('home') }}" class="nav-link hover:text-orange-500">Home</a>
          </li>
          <li>
            <a href="{{ url_for('view_recipes') }}" class="nav-link hover:text-orange-500">Recipes</a>
          </li>
          <li>
            <a href="{{ url_for('view_favorites') }}" class="nav-link hover:text-orange-500">Favorites</a>
          </li>
          <li>
            <a href="{{ url_for('profile') }}" class="nav-link hover:text-orange-500">Profile</a>
          </li>
          <li>
            <a href="{{ url_for('add_recipe') }}" class="nav-link hover:text-orange-500">Add Recipe</a>
          </li>
          {% if session.user_id %}
            <li>
              <a href="{{ url_for('logout') }}" class="nav-link hover:text-orange-500">Logout</a>
            </li>
          {% else %}
            <li>
              <a href="{{ url_for('login') }}" class="nav-link hover:text-orange-500">Login</a>
            </li>
            <li>
              <a href="{{ url_for('register') }}" class="nav-link hover:text-orange-500">Register</a>
            </li>
          {% endif %}
        </ul>
        <div class="mobile-menu">
          <button id="menu-btn" class="focus:outline-none" aria-label="Toggle navigation menu">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>
      <div id="mobile-nav" class="hidden flex-col px-6 pb-4 space-y-2 bg-white shadow-md">
        <a href="{{ url_for('home') }}" class="nav-link hover:text-orange-500">Home</a>
        <a href="{{ url_for('view_recipes') }}" class="nav-link hover:text-orange-500">Recipes</a>
        <a href="{{ url_for('view_favorites') }}" class="nav-link hover:text-orange-500">Favorites</a>
        <a href="{{ url_for('profile') }}" class="nav-link hover:text-orange-500">Profile</a>
        <a href="{{ url_for('add_recipe') }}" class="nav-link hover:text-orange-500">Add Recipe</a>
        {% if session.user_id %}
          <a href="{{ url_for('logout') }}" class="nav-link hover:text-orange-500">Logout</a>
        {% else %}
          <a href="{{ url_for('login') }}" class="nav-link hover:text-orange-500">Login</a>
          <a href="{{ url_for('register') }}" class="nav-link hover:text-orange-500">Register</a>
        {% endif %}
      </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 py-12">
      {% block content %}
      {% endblock %}
    </main>

    <div id="toast-container" class="fixed top-4 right-4 z-50"></div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const menuBtn = document.getElementById('menu-btn');
    const mobileNav = document.getElementById('mobile-nav');
    if (menuBtn && mobileNav) {
      menuBtn.addEventListener('click', () => {
        mobileNav.classList.toggle('hidden');
      });
    }

    const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;
    document.querySelectorAll('form.favorite-form').forEach((form) => {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        try {
          const response = await fetch(form.action, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
              'X-CSRF-Token': csrfToken,
            },
            body: new URLSearchParams(new FormData(form)),
          });
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          const data = await response.json();
          if (data.status === 'success') {
            const button = form.querySelector('button');
            if (data.action === 'added') {
              button.classList.replace('text-orange-500', 'text-red-500');
              button.textContent = 'Remove Favorite';
              form.action = form.action.replace('save_favorite', 'remove_favorite');
              triggerConfetti();
              showToast('Added to favorites!');
            } else {
              button.classList.replace('text-red-500', 'text-orange-500');
              button.textContent = 'Save to Favorites';
              form.action = form.action.replace('remove_favorite', 'save_favorite');
            }
          } else {
            console.error('Error:', data.message);
          }
        } catch (error) {
          console.error('Error in favorite form submission:', error);
        }
      });
    });

    // Toast Function
    function showToast(message) {
      const toast = document.createElement('div');
      toast.className =
        'fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg opacity-0 transition-opacity duration-300';
      toast.textContent = message;
      document.getElementById('toast-container').appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '1';
      }, 10);
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Confetti Function
    function triggerConfetti() {
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 },
      });
    }

    // Trigger toast from flash messages
    {% set flashed_messages = get_flashed_messages() %}
    const toastMessage = "{% if flashed_messages %}{{ flashed_messages[0] }}{% endif %}";
    if (toastMessage) {
      showToast(toastMessage);
      history.replaceState({}, document.title, window.location.pathname);
    }
  });
</script>
  </body>
</html>