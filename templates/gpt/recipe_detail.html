{% extends "base.html" %}
{% block title %}{{ recipe.title }} - My Recipes{% endblock %}
{% block content %}
<div class="max-w-2xl mx-auto px-6 py-12">
  <div class="flex items-center gap-2 mb-6">
    <div class="bg-yellow-400 p-2 rounded-md">
      <span class="font-bold text-lg">M.</span>
    </div>
    <h1 class="text-2xl font-bold">{{ recipe.title }}</h1>
  </div>
  <a href="{{ url_for('view_recipes') }}" class="text-orange-500 hover:underline mb-4 inline-block">&larr; Back to Recipes</a>
  
  <div class="mb-6">
    <p class="text-gray-600">Category: {{ recipe.category }}</p>
    {% if recipe.tags %}
    <p class="text-gray-600">Tags:</p>
    <ul class="list-disc list-inside text-sm text-gray-600">
      {% for tag in recipe.tags.split(',') %}
      <li>{{ tag.strip() }}</li>
      {% endfor %}
    </ul>
    {% endif %}
  </div>

  {% if recipe.image %}
  <img
    src="{{ url_for('static', filename='Uploads/' + recipe.image) }}"
    alt="{{ recipe.title }}"
    class="w-full h-64 object-cover rounded-md mb-6"
  />
  {% else %}
  <div class="w-full h-64 bg-gray-200 rounded-md mb-6 flex items-center justify-center">
    <span class="text-gray-500">No Image</span>
  </div>
  {% endif %}

  <h2 class="text-xl font-semibold mb-2">Ingredients</h2>
  <p class="mb-6">{{ recipe.ingredients }}</p>

  <h2 class="text-xl font-semibold mb-2">Instructions</h2>
  <p class="mb-6">{{ recipe.instructions }}</p>

  <h2 class="text-xl font-semibold mb-2">Share Recipe</h2>
  <div class="mb-6 flex gap-4">
    <button
      onclick="copyShareLink('{{ url_for('share_recipe', recipe_id=recipe.id, _external=True) }}')"
      class="bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600"
    >
      Copy Share Link
    </button>
    <a
      href="{{ url_for('download_recipe_pdf', recipe_id=recipe.id) }}"
      class="bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600"
    >
      Download PDF
    </a>
  </div>
  <script>
    function copyShareLink(url) {
      navigator.clipboard.writeText(url).then(() => {
        alert('Share link copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    }
  </script>

  <div class="mt-6 flex gap-4">
    <form
      class="favorite-form"
      action="{{ url_for('save_favorite' if recipe.id not in user_favorites_ids else 'remove_favorite', recipe_id=recipe.id) }}"
      method="POST"
    >
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <button
        type="submit"
        class="text-sm {% if recipe.id in user_favorites_ids %}text-red-500{% else %}text-orange-500{% endif %} hover:underline"
      >
        {{ 'Remove Favorite' if recipe.id in user_favorites_ids else 'Save to Favorites' }}
      </button>
    </form>
    {% if recipe.user_id == session.user_id %}
    <a
      href="{{ url_for('edit_recipe', recipe_id=recipe.id) }}"
      class="text-sm text-orange-500 hover:underline"
    >
      Edit
    </a>
    <form
      action="{{ url_for('delete_recipe', recipe_id=recipe.id) }}"
      method="POST"
    >
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <button type="submit" class="text-sm text-red-500 hover:underline">
        Delete
      </button>
    </form>
    {% endif %}
  </div>
</div>
{% endblock %}